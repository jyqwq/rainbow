import{_ as i,c as a,f as n,o as e}from"./app-t7sSfxVc.js";const l={};function t(p,s){return e(),a("div",null,s[0]||(s[0]=[n(`<h2 id="为什么需要nginx" tabindex="-1"><a class="header-anchor" href="#为什么需要nginx"><span>为什么需要Nginx</span></a></h2><p>Django有个runserver直接起了一个WebServer，为什么还要nginx起一个WebServer？</p><ul><li>可能是线上需要统一使用nginx</li><li>nginx性能比Django自带的WebServer好</li><li>因为nginx具备优秀的静态内容处理能力，然后将动态内容转发给uWSGI服务器，这样可以达到很好的客户端响应。（动静分离！）</li></ul><h2 id="什么是wsgi" tabindex="-1"><a class="header-anchor" href="#什么是wsgi"><span>什么是WSGI</span></a></h2><ul><li>WSGI，全称Web Server Gateway Interface，是为Python语言定义的Web服务器和Web应用程序或框架之间的一种简单而通用的接口。</li><li>简而言之就是，标准</li><li>很多框架都自带了WSGI server，比如Flask、webpy、Django、CherryPy等等。当然性能都不好，自带的多是测试用途，发布时则使用生产环境的WSGI server或者是联合nginx做uwsgi</li></ul><p><img src="https://file.40017.cn/baoxian/health/health_public/images/blog/blog-16.png" alt="image-20210617124232919"></p><h2 id="uwsgi概念" tabindex="-1"><a class="header-anchor" href="#uwsgi概念"><span>uWSGI概念</span></a></h2><ul><li>WSGI是一种Web服务器网关接口。它是一个Web服务器（如nginx）与应用服务器（如uWSGI服务器）通信的一种规范。</li><li>uWSGI是一个Web服务器，它实现了WSGI协议、uwsgi、http等协议。Nginx中HttpUwsgiModule的作用是与uWSGI服务器进行交换。</li><li>要注意WSGI/uWSGI/uwsgi这三个概念的区分。 <ul><li>WSGI是一种通信协议（如上图中的WSGI）</li><li>uwsgi同WSGI是一种通信协议（如上图中的WSGI）</li><li>而uWSGI是实现了uwsgi和WSGI两种协议的Web服务器（如上图中的Server）</li></ul></li></ul><p><img src="https://file.40017.cn/baoxian/health/health_public/images/blog/blog-17.png" alt="image-20210618151004823"></p><h2 id="uwsgi-ini" tabindex="-1"><a class="header-anchor" href="#uwsgi-ini"><span>uWSGI.ini</span></a></h2><div class="language-ini line-numbers-mode" data-ext="ini" data-title="ini"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">[</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">uwsgi</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#项目目录</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">chdir</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">/opt/project/teacher/</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#启动uwsgi的用户名和用户组</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">uid</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">root</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">gid</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">root</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#指定项目的application</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">module</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">teacher.wsgi:application</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#指定sock的文件路径</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">socket</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">/opt/project/script/uwsgi.sock</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#启用主进程</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">master</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">true</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#进程个数</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">workers</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">3</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">pidfile</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">/opt/project/script/uwsgi.pid</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#当服务停止时自动移除unix Socket和pid文件</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">vacuum</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">true</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#序列化接受的内容</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">thunder-lock</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">true</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#启用线程</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">enable-threads</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">true</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#设置自中断时间</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">harakiri</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">30</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#设置缓冲</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">post-buffering</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">1024</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#设置日志目录</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">daemonize</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">/opt/project/script/uwsgi.log</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="启动" tabindex="-1"><a class="header-anchor" href="#启动"><span>启动</span></a></h3><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> uwsgi</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --ini</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> uwsgi.ini</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="关闭" tabindex="-1"><a class="header-anchor" href="#关闭"><span>关闭</span></a></h3><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> $ </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">uwsgi</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --stop</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> uwsgi.pid</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="nginx-conf" tabindex="-1"><a class="header-anchor" href="#nginx-conf"><span>Nginx.conf</span></a></h2><div class="language- line-numbers-mode" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>server {</span></span>
<span class="line"><span>        listen  80;</span></span>
<span class="line"><span>        server_name  django.rainbowinpaper.com;</span></span>
<span class="line"><span>        access_log  /var/log/nginx/access.log main;</span></span>
<span class="line"><span>        charset utf-8;</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>        location / {</span></span>
<span class="line"><span>            include uwsgi_params;</span></span>
<span class="line"><span>            uwsgi_connect_timeout 30;</span></span>
<span class="line"><span>            uwsgi_pass unix:/opt/project/script/uwsgi.sock;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        location /static/ {</span></span>
<span class="line"><span>                alias   /opt/project/teacher/static_all/;</span></span>
<span class="line"><span>                index   index.html index.htm;</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>    }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="django-setting" tabindex="-1"><a class="header-anchor" href="#django-setting"><span>Django setting</span></a></h2><p>第一步需要在settings.py文件里面加入：</p><div class="language-python line-numbers-mode" data-ext="python" data-title="python"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> os</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 定义静态文件目录</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">STATICFILES_DIRS</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> (</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">os</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">path</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">join</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">BASE_DIR</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">static</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">),)</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 添加默认的静态文件目录[收集使用]</span></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">STATIC_ROOT</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> os</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">path</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">join</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">BASE_DIR</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">static_all</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后执行：</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">$</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> python</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> manage.py</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> collectstatic</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --noinput</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>`,22)]))}const r=i(l,[["render",t],["__file","index.html.vue"]]),d=JSON.parse('{"path":"/article/fs05zbud/","title":"uWSGI+Nginx+Django","lang":"zh-CN","frontmatter":{"title":"uWSGI+Nginx+Django","tags":["Django","nginx","方法论"],"createTime":"2021/10/11","permalink":"/article/fs05zbud/","description":"为什么需要Nginx Django有个runserver直接起了一个WebServer，为什么还要nginx起一个WebServer？ 可能是线上需要统一使用nginx nginx性能比Django自带的WebServer好 因为nginx具备优秀的静态内容处理能力，然后将动态内容转发给uWSGI服务器，这样可以达到很好的客户端响应。（动静分离！） 什...","head":[["meta",{"property":"og:url","content":"https://jyqwq.github.io/rainbow/article/fs05zbud/"}],["meta",{"property":"og:site_name","content":"纸上的彩虹"}],["meta",{"property":"og:title","content":"uWSGI+Nginx+Django"}],["meta",{"property":"og:description","content":"为什么需要Nginx Django有个runserver直接起了一个WebServer，为什么还要nginx起一个WebServer？ 可能是线上需要统一使用nginx nginx性能比Django自带的WebServer好 因为nginx具备优秀的静态内容处理能力，然后将动态内容转发给uWSGI服务器，这样可以达到很好的客户端响应。（动静分离！） 什..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://file.40017.cn/baoxian/health/health_public/images/blog/blog-16.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-12-03T09:57:32.000Z"}],["meta",{"property":"article:tag","content":"Django"}],["meta",{"property":"article:tag","content":"nginx"}],["meta",{"property":"article:tag","content":"方法论"}],["meta",{"property":"article:modified_time","content":"2024-12-03T09:57:32.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"uWSGI+Nginx+Django\\",\\"image\\":[\\"https://file.40017.cn/baoxian/health/health_public/images/blog/blog-16.png\\",\\"https://file.40017.cn/baoxian/health/health_public/images/blog/blog-17.png\\"],\\"dateModified\\":\\"2024-12-03T09:57:32.000Z\\",\\"author\\":[]}"]]},"headers":[],"readingTime":{"minutes":1.98,"words":593},"git":{"updatedTime":1733219852000,"contributors":[{"name":"yuan.ji","email":"yuan.ji@ly.com","commits":2,"avatar":"https://avatars.githubusercontent.com/yuan.ji?v=4","url":"https://github.com/yuan.ji"}]},"autoDesc":true,"filePathRelative":"技术文章/uWSGI+Nginx+Django.md","categoryList":[{"id":"fa6808","sort":10004,"name":"技术文章"}],"bulletin":false}');export{r as comp,d as data};
